<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TF2 Console</title>
    <link rel="stylesheet" type="text/css" href="vscode-resource:/css/console.css">
    <style>
        body {
            background-color: #1e1e1e; /* Dark mode background */
            color: #ffffff; /* White text for visibility */
            font-family: "Courier New", monospace; /* Monospace font for console-like appearance */
            padding: 10px;
        }
        h2 {
            font-size: 20px;
            color: #ffcc00; /* Gold color similar to TF2 theme */
            margin-bottom: 10px;
        }
        #consoleOutput {
            width: 100%;
            height: 400px;
            overflow-y: auto; /* Ensure scrolling when the console exceeds screen size */
            background-color: #2b2b2b; /* Slightly lighter dark background */
            border: 1px solid #444;
            padding: 10px;
            box-sizing: border-box;
            white-space: pre-wrap; /* Preserve formatting */
            font-size: 14px;
            color: #ffffff; /* White text for the console */
        }
        #commandInput {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            background-color: #2b2b2b;
            color: #ffffff;
            border: 1px solid #444;
            font-size: 14px;
            font-family: "Courier New", monospace;
            box-sizing: border-box;
        }
        #commandInput:focus {
            outline: none;
            border-color: #ffcc00; /* TF2 gold theme color on focus */
        }
    </style>
</head>
<body>
    <h2>TF2 Console</h2>
    <div id="consoleOutput" readonly></div>
    <input type="text" id="commandInput" placeholder="Enter TF2 command">

    <script>
        const vscode = acquireVsCodeApi();
        const outputArea = document.getElementById('consoleOutput');
        const commandInput = document.getElementById('commandInput');
        let commandHistory = [];
        let historyIndex = -1;

        commandInput.focus();

        commandInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                if (command) {
                    commandHistory.push(command);
                    historyIndex = -1;
                    vscode.postMessage({ command: 'sendCommand', text: command });
                    commandInput.value = '';
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                autoCompleteCommand();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                historyIndex = (historyIndex + 1 < commandHistory.length) ? historyIndex + 1 : historyIndex;
                commandInput.value = commandHistory[commandHistory.length - historyIndex - 1] || '';
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                historyIndex = historyIndex - 1 >= -1 ? historyIndex - 1 : -1;
                commandInput.value = historyIndex === -1 ? '' : commandHistory[commandHistory.length - historyIndex - 1];
            }
        });

        function autoCompleteCommand() {
            const commandText = commandInput.value.trim();
            if (commandText.length === 0) return;

            const suggestions = ['status', 'kick', 'changelevel', 'sv_cheats', 'tf_bot_add', 'exec', 'mp_restartgame'];
            const matched = suggestions.filter(cmd => cmd.startsWith(commandText));
            if (matched.length > 0) {
                commandInput.value = matched[0];
            }
        }

        window.addEventListener('message', event => {
            const message = event.data;
            if (message.type === 'response' || message.type === 'error') {
                outputArea.innerHTML += message.text + '\n';
                outputArea.scrollTop = outputArea.scrollHeight; // Auto scroll to bottom
            }
        });
    </script>
</body>
</html>
